{"version":3,"file":"sentry-core.module.js","sourceRoot":"/","sources":["sentry-core.module.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,2CAMwB;AAMxB,yDAG4B;AAC5B,qDAAiD;AACjD,yDAA2D;AAIpD,IAAM,gBAAgB,wBAAtB,MAAM,gBAAgB;IAElB,MAAM,CAAC,OAAO,CAAC,OAA4B;QAC9C,MAAM,QAAQ,GAAG,IAAA,wCAAqB,EAAC,OAAO,CAAC,CAAC;QAEhD,OAAO;YACH,OAAO,EAAE,CAAC,QAAQ,EAAE,8BAAa,CAAC;YAClC,MAAM,EAAE,kBAAgB;YACxB,SAAS,EAAE,CAAC,QAAQ,EAAE,8BAAa,CAAC;SACvC,CAAC;IACN,CAAC;IAEM,MAAM,CAAC,YAAY,CACtB,OAAiC;QAEjC,MAAM,QAAQ,GAAa;YACvB,MAAM,EAAE,CAAC,wCAAqB,CAAC;YAC/B,OAAO,EAAE,+BAAY;YACrB,UAAU,EAAE,CAAC,OAA4B,EAAE,EAAE,CAAC,IAAI,8BAAa,CAAC,OAAO,CAAC;SAC3E,CAAC;QAEF,OAAO;YACH,OAAO,EAAE,CAAC,QAAQ,EAAE,8BAAa,CAAC;YAClC,OAAO,EAAE,OAAO,CAAC,OAAO;YACxB,MAAM,EAAE,kBAAgB;YACxB,SAAS,EAAE;gBACP,GAAG,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC;gBACrC,QAAQ;gBACR,8BAAa;aAChB;SACJ,CAAC;IACN,CAAC;IAEO,MAAM,CAAC,oBAAoB,CAC/B,OAAiC;QAEjC,IAAI,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,UAAU,EAAE;YAC7C,OAAO,CAAC,IAAI,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC,CAAC;SACnD;QACD,MAAM,QAAQ,GAAG,OAAO,CAAC,QAAsC,CAAC;QAChE,OAAO;YACL,IAAI,CAAC,0BAA0B,CAAC,OAAO,CAAC;YACxC;gBACE,OAAO,EAAE,QAAQ;gBACjB,QAAQ;aACT;SACF,CAAC;IACJ,CAAC;IAEO,MAAM,CAAC,0BAA0B,CACvC,OAAiC;QAEjC,IAAI,OAAO,CAAC,UAAU,EAAE;YACtB,OAAO;gBACL,MAAM,EAAE,OAAO,CAAC,MAAM,IAAI,EAAE;gBAC5B,OAAO,EAAE,wCAAqB;gBAC9B,UAAU,EAAE,OAAO,CAAC,UAAU;aAC/B,CAAC;SACH;QACD,MAAM,MAAM,GAAG;YACb,CAAC,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,WAAW,CAA+B;SACxE,CAAC;QACF,OAAO;YACL,OAAO,EAAE,wCAAqB;YAC9B,UAAU,EAAE,CAAO,cAAoC,EAAE,EAAE,gDACzD,OAAA,MAAM,cAAc,CAAC,yBAAyB,EAAE,CAAA,GAAA;YAClD,MAAM;SACP,CAAC;IACJ,CAAC;CACN,CAAA;AArEY,gBAAgB;IAF5B,IAAA,eAAM,GAAE;IACR,IAAA,eAAM,EAAC,EAAE,CAAC;GACE,gBAAgB,CAqE5B;AArEY,4CAAgB","sourcesContent":["import {\n  Module,\n  Global,\n  Provider,\n  Type,\n  DynamicModule,\n} from '@nestjs/common';\nimport {\n  SentryModuleAsyncOptions,\n  SentryOptionsFactory,\n  SentryModuleOptions,\n} from './sentry.interfaces';\nimport {\n  SENTRY_MODULE_OPTIONS,\n  SENTRY_TOKEN,\n} from './sentry.constants';\nimport { SentryService } from './sentry.service';\nimport { createSentryProviders } from './sentry.providers';\n\n@Global()\n@Module({})\nexport class SentryCoreModule {\n\n    public static forRoot(options: SentryModuleOptions): DynamicModule {\n        const provider = createSentryProviders(options);\n\n        return {\n            exports: [provider, SentryService],\n            module: SentryCoreModule,\n            providers: [provider, SentryService],\n        };\n    }\n\n    public static forRootAsync(\n        options: SentryModuleAsyncOptions,\n    ): DynamicModule {\n        const provider: Provider = {\n            inject: [SENTRY_MODULE_OPTIONS],\n            provide: SENTRY_TOKEN,\n            useFactory: (options: SentryModuleOptions) => new SentryService(options),\n        };\n\n        return {\n            exports: [provider, SentryService],\n            imports: options.imports,\n            module: SentryCoreModule,\n            providers: [\n                ...this.createAsyncProviders(options),\n                provider,\n                SentryService,\n            ],\n        };\n    }\n\n    private static createAsyncProviders(\n        options: SentryModuleAsyncOptions,\n      ): Provider[] {\n        if (options.useExisting || options.useFactory) {\n          return [this.createAsyncOptionsProvider(options)];\n        }\n        const useClass = options.useClass as Type<SentryOptionsFactory>;\n        return [\n          this.createAsyncOptionsProvider(options),\n          {\n            provide: useClass,\n            useClass,\n          },\n        ];\n      }\n    \n      private static createAsyncOptionsProvider(\n        options: SentryModuleAsyncOptions,\n      ): Provider {\n        if (options.useFactory) {\n          return {\n            inject: options.inject || [],\n            provide: SENTRY_MODULE_OPTIONS,\n            useFactory: options.useFactory,\n          };\n        }\n        const inject = [\n          (options.useClass || options.useExisting) as Type<SentryOptionsFactory>,\n        ];\n        return {\n          provide: SENTRY_MODULE_OPTIONS,\n          useFactory: async (optionsFactory: SentryOptionsFactory) =>\n            await optionsFactory.createSentryModuleOptions(),\n          inject,\n        };\n      }\n}"]}